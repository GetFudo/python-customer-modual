{"query": {"bool": {"must": [{"match": {"status": 1}}, {"match": {"offer.status": 1}}, {"match": {"storeCategoryId": "5df8766e8798dc2f236c95fa"}}, {"match": {"storeId": "5e20914ac348027af2f9028e"}}, {"match": {"status": 1}}], "must_not": [{"match": {"storeId": "0"}}]}}, "track_total_hits": True, "sort": [{"isInStock": {"order": "desc"}}, {"units.discountPrice": {"order": "asc"}}, {"offer.status": {"order": "asc"}}], "aggs": {"group_by_sub_category": {"terms": {"field": "parentProductId.keyword", "order": {"avg_score": "desc"}, "size": 10}, "aggs": {"avg_score": {"max": {"script": "_score"}}, "top_sales_hits": {"top_hits": {"sort": [{"isInStock": {"order": "desc"}}, {"units.discountPrice": {"order": "asc"}}, {"offer.status": {"order": "asc"}}], "_source": {"includes": ["_id", "_score", "pName", "prescriptionRequired", "needsIdProof", "saleOnline", "uploadProductDetails", "storeId", "parentProductId", "currencySymbol", "currency", "pPName", "tax", "brandTitle", "categoryList", "images", "avgRating", "units", "storeCategoryId", "manufactureName", "maxQuantity"]}, "size": 1}}}}}}